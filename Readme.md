# Serverless Bookmark Application

A full-stack serverless application built using **AWS Amplify, AWS Lambda (Python), API Gateway, Amazon DynamoDB**, and **Amazon Cognito**. This application allows users to register, sign in, and manage their bookmarks securely.

---

## Table of Contents

- [Features](#features)
- [Architecture](#architecture)
- [Prerequisites](#prerequisites)
- [Setup & Deployment](#setup--deployment)
  - [Clone the Repository](#clone-the-repository)
  - [Initialize Amplify Project](#initialize-amplify-project)
  - [Deploy Backend Resources](#deploy-backend-resources)
  - [Frontend Setup (If applicable)](#frontend-setup-if-applicable)
  - [API Gateway CORS Fix](#important-api-gateway-cors-fix)
- [Usage](#usage)
- [API Endpoints](#api-endpoints)
- [Project Structure](#project-structure)
- [Troubleshooting](#troubleshooting)
- [Contributing](#contributing)
- [License](#license)

---

## Features

- **User Authentication:** Secure user registration, confirmation, and sign-in powered by Amazon Cognito.
- **Bookmark Management (CRUD):**
  - Create new bookmarks with title, URL, description, and tags.
  - Retrieve all bookmarks for the authenticated user.
  - Retrieve a single bookmark by its ID.
  - Update existing bookmark details.
  - Delete bookmarks.
- **Serverless Architecture:** Cost-effective and scalable using AWS Lambda, API Gateway, and DynamoDB.
- **API-driven:** All operations exposed via a RESTful API.

---

## Architecture

This application leverages the following AWS services:

- **AWS Amplify:** Simplifies setup and management of backend services.
- **AWS Lambda:** Handles backend logic (Python) in response to API requests.
- **Amazon API Gateway:** Manages all API requests, routes them to Lambda, manages authentication and CORS.
- **Amazon DynamoDB:** NoSQL database for storing bookmark data.
- **Amazon Cognito:** Manages user authentication and authorization.

```
+----------------+      +----------------+      +------------------+
|   Frontend     |----->|   API Gateway  |----->|   AWS Lambda     |
| (React/Web App)|      | (REST Endpoints)|     | (Python Backend) |
+----------------+      +--------+-------+      +--------+---------+
                                 |                          |
                                 v                          v
                        +----------------+          +----------------+
                        | Amazon Cognito |          | Amazon DynamoDB|
                        | (User Auth)    |          | (Bookmark Data)|
                        +----------------+          +----------------+
```

---

## Prerequisites

Make sure you have the following installed:

- **Git:** For cloning the repository.
- **Node.js & npm (or Yarn):** For Amplify CLI and frontend dependencies. [Download Node.js](https://nodejs.org/)
- **AWS CLI:** Configured with your AWS credentials.  
  - [Install AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html)
  - [Configure AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html)
- **Amplify CLI:**
  ```bash
  npm install -g @aws-amplify/cli
  ```
  [Amplify CLI Installation Guide](https://docs.amplify.aws/cli/)
- **Python 3.x:** Lambda function uses Python. Ensure Python 3.8+ is installed for development.

---

## Setup & Deployment

### Clone the Repository

```bash
git clone <repository-url>
cd Simple-Serverless-Application
```

### Initialize Amplify Project

```bash
cd bookmark-backend
amplify init
```
- Choose `python` for Lambda runtime.
- Follow the prompts and accept defaults for most questions.

### Deploy Backend Resources

```bash
amplify push
```
- Deploys Cognito, DynamoDB, Lambda, and API Gateway.
- Note the API endpoint URL and Cognito User Pool details from the output.

### Frontend Setup (If applicable)

If your frontend is in a separate directory:

```bash
cd ../bookmark-frontend
npm install
npm start # or yarn start
```
- Ensure your frontend is configured with the `aws-exports.js` (generated by Amplify).

### Important: API Gateway CORS Fix

If you get `403 Forbidden` errors for OPTIONS preflight requests, manually enable CORS in API Gateway:

1. Go to the [AWS API Gateway Console](https://console.aws.amazon.com/apigateway/).
2. Find your API.
3. In "Resources", select `/bookmarks` and then `{proxy+}` or `{bookmarkId}`.
4. Click "Actions" > "Enable CORS".
5. Configure:
   - **Origins:** `*` (for development) or your frontend origin.
   - **Methods:** GET, POST, PUT, DELETE, OPTIONS.
   - **Headers:** `*` or `Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token`.
6. Click "Enable CORS and replace existing CORS headers".
7. "Actions" > "Deploy API" (to Prod stage).

---

## Usage

1. **Register:** Create a user account via the frontend.
2. **Confirm User:** If email verification is enabled, enter the confirmation code sent to your email.
3. **Sign In:** Use your credentials to sign in.
4. **Manage Bookmarks:** Add, view, edit, or delete bookmarks.

---

## API Endpoints

Replace `<API_GATEWAY_URL>` with your deployed API URL.

| Method | Path                       | Description                        | Request Body (JSON)                                             | Response Body (JSON)                        |
|--------|----------------------------|------------------------------------|------------------------------------------------------------------|---------------------------------------------|
| POST   | `/register`                | Registers a new user               | `{ "email": "...", "password": "...", "userPoolClientId": "..."}`| `{ "message": "User registered successfully..."}` |
| POST   | `/confirm`                 | Confirms user registration         | `{ "email": "...", "confirmationCode": "...", "userPoolClientId": "..."}` | `{ "message": "User confirmed successfully."}` |
| POST   | `/signin`                  | Signs in a user                    | `{ "email": "...", "password": "...", "userPoolClientId": "..."}`| `{ "message": "Sign-in successful", "idToken": "...", "accessToken": "..."}` |
| POST   | `/bookmarks`               | Creates a new bookmark (Auth req.) | `{ "title": "...", "url": "...", "description": "...", "tags": [...]}` | `{ "userId": "...", "bookmarkId": "...", ...}` |
| GET    | `/bookmarks`               | Retrieves all bookmarks (Auth req.)| - | `[ { "userId": "...", "bookmarkId": "...", ... } ]` |
| GET    | `/bookmarks/{bookmarkId}`  | Retrieves a single bookmark (Auth req.) | - | `{ "userId": "...", "bookmarkId": "...", ... }` |
| PUT    | `/bookmarks/{bookmarkId}`  | Updates an existing bookmark (Auth req.) | `{ "title": "...", "description": "..."}` | `{ "userId": "...", "bookmarkId": "...", ... }` |
| DELETE | `/bookmarks/{bookmarkId}`  | Deletes a bookmark (Auth req.)     | - | `{ "message": "Bookmark deleted successfully." }` |

> **Note:** For authenticated endpoints, include an `Authorization` header with the user's ID Token (JWT) from Cognito:  
> `Authorization: <IdToken>`

---

## Project Structure

```
.
├── bookmark-backend/
│   ├── bookmark_function/      # AWS Lambda function code
│   │   ├── app.py              # Main Lambda handler
│   │   ├── requirements.txt    # Python dependencies for Lambda
│   ├── amplify/                # Amplify CLI backend configuration
│   │   ├── backend/
│   │   │   ├── auth/           # Cognito configuration
│   │   │   ├── api/            # API Gateway & Lambda configuration
│   │   │   ├── storage/        # DynamoDB configuration
│   └── .gitignore
├── bookmark-frontend/          # Frontend app (React, etc.)
│   ├── public/
│   ├── src/
│   │   ├── App.js
│   │   ├── index.js
│   │   ├── aws-exports.js      # Auto-generated by Amplify CLI
│   ├── package.json
└── README.md
```

---

## Troubleshooting

- **500 Internal Server Error: `module 'boto3' has no attribute 'util'`**
  - **Cause:** Lambda using old code referencing `boto3.util.current_time_millis()`.
  - **Solution:** Update `app.py` to use `datetime.datetime.now(datetime.timezone.utc).timestamp() * 1000` and redeploy with `amplify push`.

- **500 Internal Server Error: `Object of type Decimal is not JSON serializable`**
  - **Cause:** DynamoDB returns numbers as Python `Decimal`.
  - **Solution:** Use a custom `DecimalEncoder` (see `app.py`) and pass `cls=DecimalEncoder` to all `json.dumps()` calls. Redeploy.

- **403 Forbidden for OPTIONS requests (CORS preflight failures)**
  - **Cause:** Improper API Gateway CORS configuration.
  - **Solution:** Manually enable CORS for the endpoint in API Gateway and redeploy (see [CORS Fix](#important-api-gateway-cors-fix)).

- **Backend changes not reflecting after git push**
  - **Cause:** Amplify Console build pipeline not triggered or failed.
  - **Solution:** Check build status in Amplify Console and inspect logs for errors.

---

## Contributing

Contributions are welcome!  
To contribute:

1. Fork the repository.
2. Create a new branch:
   ```bash
   git checkout -b feature/your-feature
   ```
3. Make your changes.
4. Commit:
   ```bash
   git commit -m "Add new feature"
   git push origin feature/your-feature
   ```
5. Open a Pull Request.

---

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.